<!DOCTYPE html><html lang="en" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link href="/assets/css/syntax.css" rel="stylesheet" ><link href="https://fonts.googleapis.com/css2?family=Comic+Neue&display=swap" rel="stylesheet"><meta name="generator" content="Jekyll v4.0.1" /><meta property="og:title" content="Migrasi Sprockets ke Webpacker" /><meta name="author" content="Ali" /><meta property="og:locale" content="en_US" /><meta name="description" content="Saya senang sekali webpacker telah hadir secara default di rails 6 sebagai penanganan web assets. Dengan hadirnya webpacker kita bisa menggeser untuk tidak menggunakan sprockets. Meski demikian, kita bisa menggunakan keduanya secara bersamaan." /><meta property="og:description" content="Saya senang sekali webpacker telah hadir secara default di rails 6 sebagai penanganan web assets. Dengan hadirnya webpacker kita bisa menggeser untuk tidak menggunakan sprockets. Meski demikian, kita bisa menggunakan keduanya secara bersamaan." /><link rel="canonical" href="http://localhost:4000/migrasi-sprokets-ke-webpacker" /><meta property="og:url" content="http://localhost:4000/migrasi-sprokets-ke-webpacker" /><meta property="og:site_name" content="RubyHolic" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-06-24T15:44:00+07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Migrasi Sprockets ke Webpacker" /><meta name="twitter:site" content="@alisoftware" /><meta name="twitter:creator" content="@alisoftware" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ali","url":"www.situsali.id"},"dateModified":"2020-06-24T15:44:00+07:00","datePublished":"2020-06-24T15:44:00+07:00","description":"Saya senang sekali webpacker telah hadir secara default di rails 6 sebagai penanganan web assets. Dengan hadirnya webpacker kita bisa menggeser untuk tidak menggunakan sprockets. Meski demikian, kita bisa menggunakan keduanya secara bersamaan.","headline":"Migrasi Sprockets ke Webpacker","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/migrasi-sprokets-ke-webpacker"},"url":"http://localhost:4000/migrasi-sprokets-ke-webpacker"}</script><title> Migrasi Sprockets ke Webpacker - RubyHolic</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="RubyHolic" href="/atom.xml"><link rel="alternate" type="application/json" title="RubyHolic" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}code,pre{background:transparent}html,body{font-family:'Comic Neue', cursive;font-size:1.2rem}</style></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">RubyHolic</h1>--><nav role="navigation"><ul><li><a href="/" >Home</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li><li><a href="/atom.xml" >Rss</a></li></ul></nav></header><section class="post"><h2>Migrasi Sprockets ke Webpacker</h2><p>Saya senang sekali webpacker telah hadir secara default di rails 6 sebagai penanganan web assets. Dengan hadirnya webpacker kita bisa menggeser untuk tidak menggunakan sprockets. Meski demikian, kita bisa menggunakan keduanya secara bersamaan.</p><p>Ketika kalian menggunakan rails 6 dan membuat project dengan menggunakan perintah:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails new your_project
</code></pre></div></div><p>Perintah di atas, sudah menyertakan webpacker sebagai penangan <code class="highlighter-rouge">js</code> dan sprockets sebagai penanganan <code class="highlighter-rouge">css</code> dan <code class="highlighter-rouge">image</code>.</p><p>Bagi saya cukup boros mengunakan dua engine untuk menangani masalah assets. Padahal cukup menggunakan webpacker, itu sudah bisa semua.</p><p>Kalau kalian baru memulai membuat project di rails 6. Saya menyarankan gunakan perintah:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails new your_project --skip-sprockets
</code></pre></div></div><p>Bagimana yang sudah terlanjur menggunakan dua engine webpacker dan sprockets di rails? Atau tidak menggunakan rails 6 namun ingin pakai webpacker?</p><p>Nah, tulisan inilah saya mencoba berbagi berdasarkan pengalaman saat migrasi dari sprockets menuju webpacker.</p><h2 id="penggunan-rails-5-atau-ke-bawah">Penggunan Rails 5 atau ke bawah</h2><p>Di mulai dari para penggunakan rails &lt;= 5. Pertama-tama kalian pasang dulu gem webpacker di GemFile.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'webpacker'
</code></pre></div></div><p>Lalu pasang webpacker tersebut pada rails.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle
rails webpacker:install
</code></pre></div></div><p>Kemudian kalian ubah skrip <code class="highlighter-rouge">javascript_include_tag</code> menjadi <code class="highlighter-rouge">javascript_pack_tag</code> di <code class="highlighter-rouge">view/layouts</code>. Begitu juga untuk <code class="highlighter-rouge">stylesheet_include_tag</code> ganti menjadi <code class="highlighter-rouge">stylesheet_pack_tag</code>.o</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- javascript_include_tag
+ javascript_pack_tag

- stylesheet_include_tag
+ stylesheet_pack_tag
</code></pre></div></div><p>Dengan mengubah skrip di atas, seharusnya tampilan web kalian menjadi berantakan. Karena css dan js bawaan sprockets tidak di load.</p><p>Terakhir, buat berkas <code class="highlighter-rouge">application.js</code> di direktori <code class="highlighter-rouge">app/javascript/packs</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> app/javascript/packs
<span class="nb">touch </span>application.js
</code></pre></div></div><p>Susunan berkasnya seperti berikut:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>app/javascript:
 └── packs:
   └── application.js
</code></pre></div></div><h2 id="test-pastikan-webpacker-sudah-berjalan">Test Pastikan Webpacker sudah berjalan</h2><p>Nah untuk memastikan webpacker sudah berjalan atau belum kalian bisa mengetesnya dengan skrip sederhana berikut yang terletak pada <code class="highlighter-rouge">app/javascript/packs/application.js</code>:</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello world from Webpacker</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div><p>Kalau sudah terlihat di browser, selamat webpacker sudah terpasang baik di rails kalian!</p><h2 id="konfigurasi-webpacker">Konfigurasi Webpacker</h2><p>Sebelum bermigrasi, adakalanya kita mesti konfigurasi dulu webpacker-nya.</p><p>Langkah pertama ialah, rename direktori <code class="highlighter-rouge">app/javascript</code> menjadi <code class="highlighter-rouge">app/webpacker</code>. Karena kita ingin semua assets ditangani oleh webpacker maka direktori javascript diubah menjadi webpacker.</p><p>Sebetulnya, tidak di-rename juga tidak apa-apa. Namun menurut saya itu tidak bagus. Karena di dalam direktori tersubut, nantinya kita juga akan memasukan css, images, fonts, dan berkas aset lainnya selain js. Makanya lebih baik diganti namanya menjadi webpacker.</p><p>Untuk mengubahnya kalian ubah pada berkas <code class="highlighter-rouge">config/webpacker.yml</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim config/webpacker.yml
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sourch_path: app/webpacker
extract_css: true
</code></pre></div></div><p>Setelah itu buat direktori seperti berikut:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>app/webpacker:
├── fonts
├── images
├── packs
│  └── application.js
└── src
   ├── javascripts
   └── stylesheets
</code></pre></div></div><p>dengan perintah:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="o">{</span>fonts,images,src/javascripts,src/stylessheets<span class="o">}</span>
</code></pre></div></div><p>Dengan susunan direktori seperti di atas. Kalian dapat memindahkan semua css/scss ke <code class="highlighter-rouge">app/webpacker/src/stylessheets</code> begitu juga dengan js, pindahkan semua ke <code class="highlighter-rouge">app/webpacker/src/javascripts</code></p><h2 id="migrasi-cssscss">Migrasi CSS/SCSS</h2><p>Setelah melakukan konfigurasi pada webpacker. Langkah selanjutnya kita pindahkan semua css/scss ke <code class="highlighter-rouge">app/webpacker/src/stylessheets</code>.</p><p>Jika sudah, kita import css/scss terusebut di <code class="highlighter-rouge">packs/application.js</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim app/webpacker/packs/application.js
</code></pre></div></div><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">"</span><span class="s2">bulma</span><span class="dl">"</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">../src/stylessheets/my_css</span><span class="dl">"</span>
</code></pre></div></div><p>Tanpa perlu extention, webpacker sudah langsung otomatis tau.</p><p>Kalian bisa perhatikan cara import baris pertama dan kedua berbeda. Mengapa bisa beda? Karena baris pertama di dapat dari <code class="highlighter-rouge">node_modules</code> yakni dengan perintah:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add bulma
</code></pre></div></div><h3 id="menggunakan-applicationscss-optional">Menggunakan application.scss (Optional)</h3><p>Cara di atas, kita meng-import berkas stylesheets dari js. Sebetulnya kita juga bisa menggunakan berkas di <code class="highlighter-rouge">packs/application.scss</code>.</p><p>Caranya pun hampir sama. Pertama buat dulu berkasnya.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>app/webpacker/packs/application.scss
</code></pre></div></div><p>Lalu kalian tinggal import seperti ini:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@import</span> <span class="s1">'~bulma/scss/bulma'</span><span class="p">;</span>
<span class="k">@import</span> <span class="s1">'../src/stylesheets/my_css'</span><span class="p">;</span>
</code></pre></div></div><p>Nah untuk baris pertama, caranya beda lagi. Kalau kita ingin import dari <code class="highlighter-rouge">node_modules</code> di scss, ditambah tilda <code class="highlighter-rouge">~</code> untuk meng-import berkas-berkas yang bersumber dari <code class="highlighter-rouge">node_modules</code>.</p><h2 id="migrasi-javascript">Migrasi Javascript</h2><p>Setelah semua stylesheet dipindakan. Selanjutnya berkas js juga dipindahkan.</p><p>Nah, caranya juga sama. Tinggal import lagi di <code class="highlighter-rouge">packs/application.js</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim app/webpacker/packs/application.js
</code></pre></div></div><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">"</span><span class="s2">bulma</span><span class="dl">"</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">../src/javascript/my_script</span><span class="dl">"</span>
</code></pre></div></div><h2 id="migrasi-images">Migrasi Images</h2><p>Untuk berkas gambar. Kalian masukan di <code class="highlighter-rouge">webpacker/images</code>.</p><p>Dan sunting <code class="highlighter-rouge">packs/application.js</code> nya menjadi</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">require</span><span class="p">.</span><span class="nx">context</span><span class="p">(</span><span class="dl">'</span><span class="s1">../images</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div></div><p>Jangan lupa. Ganti semua skrip yang menggunakan <code class="highlighter-rouge">asset_path</code> menjadi <code class="highlighter-rouge">image_pack_path</code>.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> - asset_path('icon.png')
 + image_pack_path('icon.png')
</code></pre></div></div><p>Jika dalam berkas stylesheet (css/scss) kalian ada yang meng-import gambar. Lakukan seperti contoh di bawah:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">.google-icon</span> <span class="p">{</span>
<span class="na">-</span><span class="err">   </span><span class="nl">background-image</span><span class="p">:</span> <span class="nf">image-url</span><span class="p">(</span><span class="s1">'btn_google_dark.svg'</span><span class="p">);</span>
<span class="err">+   </span><span class="nl">background-image</span><span class="p">:</span> <span class="sx">url('../images/btn_google_dark.svg')</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div><p>Tanda minus berarti diapus dan tanda plus berarti digantikan.</p><h2 id="migrasi-fonts">Migrasi Fonts</h2><p>Nah ini bagian terakhir dari sesi pemindahan. Sama seperti diberkas lainnya. Kalian mesti memindahkannya di <code class="highlighter-rouge">app/webpacker/fonts</code></p><p>Dan jangan lupa ganti discript stylesheets kalian:</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@font-face</span> <span class="p">{</span>
 <span class="nl">font-family</span><span class="p">:</span> <span class="n">YourFontFamily</span><span class="p">;</span>
 <span class="nl">src</span><span class="p">:</span> <span class="sx">url('../fonts/yourfile.ttf')</span> <span class="nf">format</span><span class="p">(</span><span class="s1">'truetype'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="hapus-sprockets-hingga-keakar-akarnya">Hapus Sprockets Hingga Keakar-akarnya!</h2><p>Kalian sudah memindahkan seluruh assets ke webpacker. Namun, itu semua belum sepenuhnya migrasi. Kita masih tetap bisa menggunakan sprockets.</p><p>Kalau kalian ingin menghapus hingga keakar-akarnya. Kalian perlu melakukan ini:</p><ol><li><p>Buang gem <code class="highlighter-rouge">sass-rails</code>.</p><p>Hapus atau beri comment <code class="highlighter-rouge">sass-rails</code> dari GemFile</p><div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># gem 'sass-rails'</span>
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> bundle
</code></pre></div></div></li><li><p>Hapus <code class="highlighter-rouge">require "sprockets/railtie"</code> dari <code class="highlighter-rouge">config/application.rb</code>.</p><div class="language-rb highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># require "sprockets/railtie"</span>
</code></pre></div></div></li><li><p>Hapus <code class="highlighter-rouge">config.assets.*</code> dari dua file <code class="highlighter-rouge">development.rb</code> dan <code class="highlighter-rouge">production.rb</code> dari <code class="highlighter-rouge">config/environment</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">cd </span>config/environment
 vim development.rb
 vim production.rb
</code></pre></div></div><p>Kode yang dihapus</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> config.assets.debug = true
 config.assets.quiet = true
</code></pre></div></div></li><li>Hapus file <code class="highlighter-rouge">config/initializers/assets.rb</code>.</li><li>(Optional) Hapus direktori <code class="highlighter-rouge">app/assets</code>.</li></ol><h2 id="test-it">Test it!</h2><p>Langkah terakhir, yakni tes! Kalian bisa lakukan perintah berikut:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails assets:precompile
</code></pre></div></div><p>Kalau tidak terjadi error berarti kalian sudah sukses mengapus sprockets dari rails kalian!</p><p>Semoga bermanfaat :)</p><span class="meta"><time datetime="2020-06-24T15:44:00+07:00">June 24, 2020</time> &middot; </span> <!--<span class="meta"><time datetime="2020-06-24T15:44:00+07:00">June 24, 2020</time> &middot; </span> --></section></main></body></html>
